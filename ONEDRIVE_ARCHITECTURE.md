# OneDrive 동기화 아키텍처 설명

## 🔄 작동 원리

### 현재 제안한 방식의 흐름

```
[웹 사용자] → [백엔드 서버] → [로컬 OneDrive 파일] → [OneDrive 클라이언트] → [SharePoint]
     ↓              ↓                    ↓                      ↓                ↓
  면접관/관리자   API 호출          Excel 읽기/쓰기        자동 동기화      다른 사용자 확인
```

### 상세 흐름

1. **웹 사용자 액션** (면접관, 관리자 등)
   - 프론트엔드에서 API 호출
   - 예: 면접 일정 선택, 면접 생성 등

2. **백엔드 서버 처리**
   - API 요청 받음
   - 로컬 OneDrive 파일 경로로 Excel 읽기/쓰기
   - `xlsx` 라이브러리 사용

3. **OneDrive 자동 동기화**
   - 로컬 파일 변경 감지
   - 자동으로 SharePoint에 업로드
   - 보통 몇 초~몇 분 내 동기화

4. **다른 사용자 확인**
   - SharePoint에서 실시간으로 확인 가능
   - Excel 파일 직접 열어서 확인 가능

---

## ⚠️ 중요한 제약사항

### 1. 서버 컴퓨터에 OneDrive 설치 필요

- **백엔드 서버가 실행되는 컴퓨터**에 OneDrive 클라이언트가 설치되어 있어야 함
- Windows: 기본 포함
- Linux/Mac: 별도 설치 필요

### 2. 서버 컴퓨터의 OneDrive에 동기화 필요

- SharePoint 파일이 **서버 컴퓨터의 OneDrive**에 동기화되어 있어야 함
- 로컬 파일 경로로 접근 가능해야 함

### 3. 파일 경로 예시

```
서버 컴퓨터의 OneDrive 경로:
C:\Users\[서버사용자명]\OneDrive - [회사명]\[사이트명]\면접.xlsx
```

### 4. 동시 접근 문제

- 여러 사용자가 동시에 액션을 취하면 파일 충돌 가능
- 파일 잠금 메커니즘 필요

---

## 🤔 문제점

### 문제 1: 서버 배포 환경

**로컬 개발 환경:**
- ✅ OneDrive 설치되어 있음
- ✅ 동기화 가능

**프로덕션 서버 (AWS EC2, Linux 등):**
- ❌ OneDrive 클라이언트 설치 어려움
- ❌ GUI 없는 환경에서 동기화 복잡

### 문제 2: 여러 서버 인스턴스

- 여러 서버가 동시에 실행되면 파일 충돌
- 각 서버마다 OneDrive 동기화 필요

---

## ✅ 더 나은 대안

### 대안 1: SharePoint REST API 유지 + 토큰 갱신 자동화

**원리:**
- SharePoint REST API 직접 사용 (현재 방식)
- 토큰 갱신을 자동화하는 엔드포인트 추가
- 사용자가 주기적으로 Graph Explorer에서 새 토큰 입력 (1시간마다)

**장점:**
- ✅ 서버 환경에 관계없이 작동
- ✅ 여러 서버 인스턴스 지원
- ✅ SharePoint 직접 접근

**단점:**
- ⚠️ 1시간마다 수동 토큰 갱신 필요

### 대안 2: 백엔드 토큰 갱신 스케줄러

**원리:**
- 백엔드에 토큰 갱신 엔드포인트 추가
- 사용자가 주기적으로 새 토큰 입력
- 또는 Puppeteer로 Graph Explorer 자동화 (복잡)

**장점:**
- ✅ 자동화 가능

**단점:**
- ⚠️ 구현 복잡
- ⚠️ MFA/보안 정책에 따라 실패 가능

### 대안 3: 데이터베이스 사용 (SQLite/PostgreSQL)

**원리:**
- Excel 대신 데이터베이스 사용
- SharePoint Excel은 보고서용으로만 사용

**장점:**
- ✅ 토큰 문제 완전 해결
- ✅ 동시 접근 처리 우수
- ✅ 안정적

**단점:**
- ⚠️ SharePoint Excel과 분리
- ⚠️ 공유 기능 제한

---

## 🎯 추천 방안

### 상황별 추천

#### 1. 로컬 개발 환경만 사용
→ **OneDrive 동기화** 사용 가능

#### 2. 프로덕션 서버 배포 예정
→ **SharePoint REST API + 수동 토큰 갱신** (현재 방식 유지)
또는 **데이터베이스 사용**

#### 3. 완전 자동화 필요
→ **데이터베이스 사용** (SQLite 또는 PostgreSQL)

---

## 💡 질문

어떤 환경에서 사용하시나요?

1. **로컬 개발 환경만** → OneDrive 동기화 가능
2. **프로덕션 서버 배포 예정** → SharePoint REST API 유지 또는 데이터베이스
3. **완전 자동화 필요** → 데이터베이스 사용

선택해주시면 그에 맞게 구현하겠습니다!
